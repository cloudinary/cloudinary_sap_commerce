!function(){"use strict";var e=self.console,n=Object.freeze({NONE:0,ERROR:1,WARN:2,INFO:3,LOG:4}),t=["error","warn","info","log"],o=void 0!==e&&void 0!==e.log&&void 0!==e.error&&void 0!==e.debug&&void 0!==e.warn&&"function"==typeof Function.prototype.apply,r=void 0,i=void 0,a=function(n,t,o,r){return e[t]?o?e[t](o):e[t]():n.log("----------- "+(o||r)+" ----------- ")},l=function(n){var i=n.level,l={setLevel:function(e){return i=e,l},getLevel:function(){return i||r}};return t.forEach(function(n){l[n]=function(){for(var r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];return function(n,r,i){if(o){var a=t.indexOf(r),l=n.getLevel();return~a&&l>=a+1&&e[r].apply(e,i),n}}(l,n,i)}}),l.groupCollapsed=function(e){return a(l,"groupCollapsed",e,"GROUP START")},l.group=function(e){return a(l,"group",e,"GROUP START")},l.groupEnd=function(){return a(l,"groupEnd",null,"GROUP END")},l.debug=l.log,l},s=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.level=e.level||n.NONE;var t=e.newInstance||!i?l(e):i;return i||e.newInstance||(i=t),t},c="ML_WIDGET_INIT",u="ML_WIDGET_SHOW",d="ML_WIDGET_HIDE",f="ML_WIDGET_ERROR",p="ML_WIDGET_INSERT_DATA",y="ML_WIDGET_EXPOSE_IDENTITY",g=["cloud_name","api_key","username","timestamp","signature","integration"],m=["access_token","redirect_url","cloud_name"],v=["integration","inline_container","z_index","multiple","max_files","default_transformations","insert_caption","remove_header","folder","search","collection","asset","transformation","sandboxNotAllowedAttributes"],b=["allow-forms","allow-modals","allow-orientation-lock","allow-pointer-lock","allow-popups","allow-popups-to-escape-sandbox","allow-presentation","allow-same-origin","allow-scripts","allow-top-navigation","allow-top-navigation-by-user-activation"],h=s(),w=function(e,n){var t=null;try{t="string"==typeof e?JSON.parse(e):e}catch(e){h.error("[postmessage]: failed to parse data from "+n,e)}return t},_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E=function(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e},O=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},L=(s(),function(e){return new Promise(function(n,t){var o,r=!1,i=function(e,n){var t=void 0,o=Array.isArray(n.allowedOrigin)?n.allowedOrigin:[n.allowedOrigin],r=n.types,i=function(e){if(!e||!e.length)throw"PostMessage - target not set!"},a=function(e){if(~o.indexOf(e.origin)){t=e.origin;var i=w(e.data,e.origin);i&&(n.validator&&!n.validator(i.data)||i.type&&r[i.type]&&(h.log("[postmessage]: found matching handler for '"+i.type+"' event from: "+e.origin,i.data),r[i.type](i.data,i.type,e,n)))}};return i(o),self.addEventListener("message",a,!1),{send:function(n,o){var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).target||t;i(r);try{h.log("[postmessage]: posting message to: "+r),e instanceof HTMLIFrameElement&&(e=e.contentWindow),e.postMessage(JSON.stringify({type:n,data:o}),r)}catch(e){h.error("[postmessage]: failed to post message to target: "+r,e)}},close:function(){return self.removeEventListener("message",a)}}}(e.ifr,{validator:function(n){return n&&n.mlId&&n.mlId===e.mlId},allowedOrigin:e.mlUrl.origin,types:(o={},E(o,p,function(n){e.callbacks.insertHandler&&e.callbacks.insertHandler(n)}),E(o,y,function(n){e.callbacks.identityHandler&&e.callbacks.identityHandler(n)}),E(o,d,function(){e.hideCms()}),E(o,f,function(n){e.callbacks.errorHandler&&e.callbacks.errorHandler(n)}),o)}),a=function(n,t){i.send(n,t,{target:e.mlUrl.origin})};e.ifr.addEventListener("load",function(){r||(r=!0,e.iframeLoaded(),n({sendMessage:a}))}),self.addEventListener("message",function(n){var t=w(n),o=w(t.data);o&&"object"===(void 0===o?"undefined":_(o))&&"consoleLoaded"===o.type&&a(c,e)},!1),e.ifr.addEventListener("error",function(){})})});!function(e){var t,o=0;e.location.search.indexOf("debug=true")>-1&&(t=n.LOG,r=t);var i=function(n,t,r){var i=void 0,a=void 0,l=null,s=!1,c=!1,f=!!n.inline_container,p=null,y=!!n.access_token,h="ml_"+o;o+=1;var w=function(e){27===e.keyCode&&N.hide()},_="https://"+(!0===n.dev?"dev.cloudinary.com":!0===n.nightly?"nightly.cloudinary.com":!0===n.staging?"staging.cloudinary.com":!0===n.staging2?"staging2.cloudinary.com":"cloudinary.com"),A=function(e,n,t){var o,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=(o=[],Object.keys(r).forEach(function(e){return o.push(e+"="+r[e])}),t.filter(function(e){return Boolean(n[e])}).forEach(function(e){var t=n[e];if("[object Object]"===Object.prototype.toString.call(t)){var r=[],i=!0,a=!1,l=void 0;try{for(var s,c=Object.keys(t)[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;r.push(u+":"+encodeURIComponent(t[u]))}}catch(e){a=!0,l=e}finally{try{!i&&c.return&&c.return()}finally{if(a)throw l}}o.push(e+"="+r.join("|"))}else o.push(e+"="+encodeURIComponent(t))}),o),a=_+e+"?"+i.join("&");return{origin:_,href:a}},I=function(e){window.requestAnimationFrame(function(){a.style.padding=e.matches?"25px":"25px 0"})},x=function(e){var n=f?i:a;(function(e){var n=document.body;if(f&&"string"==typeof(n=e.inline_container)&&(n=document.querySelector(n)),!n)throw"Element Not Found ("+e.inline_container+")";return n})(e).appendChild(n),i.focus()},k=function(){var n=f?i:a;c&&s?(n.style.visibility="visible",n.focus(),!f&&e.document.addEventListener("keyup",w)):(n.style.visibility="hidden",e.document.removeEventListener("keyup",w))},S=function(){c=!0,k()},H=function(){!f&&document.body&&(null===p&&(p=document.body.style.overflow),document.body.style.overflow="hidden"),s=!0,k(),t.showHandler&&t.showHandler()},M=function(){!f&&document.body&&null!==p&&(document.body.style.overflow=p,p=null),s=!1,k(),t.hideHandler&&t.hideHandler()},T=f?t.insertHandler:function(e){t.insertHandler(e),M()};!function(){var o=O({},n),s=o.sandboxAttributes,c=self.location;"null"===c.origin&&(c=new URL(self.origin));var u,d,p,w,_,k,N=A("/console/media_library/cms",o,g,O({pmHost:c.protocol+"//"+c.host,new_cms:!0,ml_id:h},(u=s,Array.isArray(u)&&-1===u.indexOf("allow-popups")?{sandbox_no_popup:!0}:{}))),R=y?A("/console/api/v1/auth/login_with_oauth_token",O({},n,{redirect_url:N.href}),m).href:N.href;o.mlUrl=N,o.callbacks=t,s&&(o.sandboxNotAllowedAttributes=function(e){var n=[];return Array.isArray(e)&&(n=b.filter(function(n){return-1===e.indexOf(n)})),n}(s)),r&&(d="string"==typeof(w=r)?document.querySelector(w):w,p=e.document.createElement("button"),d.style.display="none",p.setAttribute("class",n.button_class||"cloudinary-button"),p.innerHTML=n.button_caption||"Open Media Library",d.parentNode.insertBefore(p,d.previousSibling),p.addEventListener("click",function(e){return H(),e&&e.preventDefault&&e.preventDefault(),e&&e.stopPropagation&&e.stopPropagation(),!1},!1)),function(t){if((i=e.document.createElement("iframe")).setAttribute("src",t),i.setAttribute("frameborder","no"),i.setAttribute("allow","camera"),f?(i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.style.border="none"):(i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.style.boxShadow="0 0 50px rgba(0, 0, 0, 0.8)"),!f){if((a=e.document.createElement("div")).style.position="fixed",a.style.top="0",a.style.left="0",a.style.height="100%",a.style.width="100%",a.style.boxSizing="border-box",a.style.backgroundColor="rgba(0,0,0,0.5)",a.style.zIndex=n.z_index||99999,matchMedia){var o=window.matchMedia("(min-width: 700px)");o.addListener(I),I(o)}a.style.visibility="hidden",a.appendChild(i)}}(R),l=L({ifr:i,mlId:h,mlUrl:N,callbacks:O({},t,{insertHandler:T}),iframeLoaded:S,hideCms:M,config:(_=o,k=v,k.reduce(function(e,n){return void 0!==_[n]?O({},e,E({},n,_[n])):e},{}))}),x(o)}();var N={show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.then(function(n){n.sendMessage(u,{mlId:h,options:O({},e,{config:e}),config:e}),H()}),this},hide:function(){return l.then(function(e){e.sendMessage(d,{mlId:h}),M()}),this}};return N};e.cloudinary=e.cloudinary||{},e.cloudinary.openMediaLibrary=function(e,n,t){return i(e,n,t).show(e)},e.cloudinary.createMediaLibrary=function(e,n,t){return i(e,n,t)}}(self)}();
